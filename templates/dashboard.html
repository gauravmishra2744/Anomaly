<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anomaly Detection - Cybersecurity</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: rgba(10,14,39,0.8);
            --text-primary: #e0e7ff;
            --text-secondary: #8b9dc3;
            --border-color: rgba(0,255,255,0.2);
            --accent-cyan: #00ffff;
            --accent-magenta: #ff00ff;
            --accent-green: #00ff88;
            --accent-red: #ff0055;
            --accent-orange: #ff6600;
            --accent-yellow: #ffaa00;
            --shadow-color: rgba(0,255,255,0.2);
            --gradient-start: rgba(0,255,255,0.1);
            --gradient-end: rgba(255,0,255,0.1);
        }
        body.light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #cbd5e1;
            --accent-cyan: #0ea5e9;
            --accent-magenta: #a855f7;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-orange: #f97316;
            --accent-yellow: #eab308;
            --shadow-color: rgba(0,0,0,0.1);
            --gradient-start: rgba(14,165,233,0.1);
            --gradient-end: rgba(168,85,247,0.1);
        }
        body.light-mode .header h1,
        body.light-mode .card-title {
            background: linear-gradient(135deg, #0ea5e9 0%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        body.light-mode .stat-value {
            text-shadow: none;
        }
        body.light-mode .metric-value {
            text-shadow: none;
        }
        body {
            font-family: Rajdhani, sans-serif;
            background: var(--bg-primary);
            background-image: radial-gradient(at 0% 0%, var(--gradient-start) 0px, transparent 50%),
                              radial-gradient(at 100% 100%, var(--gradient-end) 0px, transparent 50%);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px var(--shadow-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .theme-toggle {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-cyan);
            color: var(--accent-cyan);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .theme-toggle:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            transform: scale(1.05);
        }
        .nav-link {
            color: var(--accent-cyan);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 600;
            border: 1px solid transparent;
        }
        .nav-link:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-color: var(--accent-cyan);
        }
        .header h1 {
            font-family: Orbitron, sans-serif;
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, #00ffff 0%, #ff00ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-badge {
            background: linear-gradient(135deg, #00ff88 0%, #00ffff 100%);
            color: #0a0e27;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 20px rgba(0,255,136,0.5);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px var(--shadow-color);
            transition: all 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-cyan);
            box-shadow: 0 10px 30px var(--shadow-color);
        }
        .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stat-title { font-size: 14px; color: #8b9dc3; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .stat-icon { width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .stat-value { font-family: Orbitron, sans-serif; font-size: 36px; font-weight: 700; margin-bottom: 5px; }
        body:not(.light-mode) .stat-value { text-shadow: 0 0 10px currentColor; }
        .stat-change { font-size: 13px; color: #6b7fa8; }
        .main-content { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        .card {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px var(--shadow-color);
        }
        .footer {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 20px 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .footer-text {
            color: var(--text-secondary);
            font-size: 14px;
        }
        .footer-team {
            font-weight: 700;
            color: var(--accent-cyan);
            font-family: Orbitron, sans-serif;
        }
        .card-title {
            font-family: Orbitron, sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-cyan);
        }
        body:not(.light-mode) .card-title {
            text-shadow: 0 0 10px rgba(0,255,255,0.5);
        }
        .input-group { margin-bottom: 20px; }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #8b9dc3;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 1px;
        }
        .input-group input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 15px;
            color: var(--text-primary);
            font-family: Orbitron, sans-serif;
            transition: all 0.3s;
        }
        .input-group input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 10px var(--shadow-color);
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: Rajdhani, sans-serif;
        }
        .btn-primary {
            background: linear-gradient(135deg, #00ffff 0%, #ff00ff 100%);
            color: #0a0e27;
            box-shadow: 0 0 20px rgba(0,255,255,0.5);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(0,255,255,0.7); }
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--accent-cyan);
            border: 2px solid var(--accent-cyan);
        }
        .btn-secondary:hover { 
            background: var(--accent-cyan); 
            color: var(--bg-primary);
            transform: translateY(-2px);
        }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .result-card {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid var(--border-color);
            border-left: 4px solid var(--accent-cyan);
            box-shadow: 0 5px 15px var(--shadow-color);
        }
        .result-card.anomaly { border-left-color: var(--accent-red); }
        .result-card.normal { border-left-color: var(--accent-green); }
        .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .result-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .result-badge.anomaly {
            background: linear-gradient(135deg, #ff0055 0%, #ff00ff 100%);
            color: white;
            box-shadow: 0 0 15px rgba(255,0,85,0.5);
        }
        .result-badge.normal {
            background: linear-gradient(135deg, #00ff88 0%, #00ffff 100%);
            color: #0a0e27;
            box-shadow: 0 0 15px rgba(0,255,136,0.5);
        }
        .result-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 14px; }
        .result-item { display: flex; justify-content: space-between; }
        .result-label { color: #8b9dc3; font-weight: 600; }
        .result-value { font-weight: 700; color: #00ffff; font-family: Orbitron, sans-serif; }
        .loading { display: none; text-align: center; padding: 40px; }
        .spinner {
            border: 4px solid rgba(0,255,255,0.1);
            border-top: 4px solid #00ffff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
            box-shadow: 0 0 20px rgba(0,255,255,0.5);
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            border: 1px solid;
        }
        .alert-success {
            background: rgba(0,255,136,0.1);
            color: #00ff88;
            border-color: rgba(0,255,136,0.3);
            box-shadow: 0 0 20px rgba(0,255,136,0.2);
        }
        .alert-error {
            background: rgba(255,0,85,0.1);
            color: #ff0055;
            border-color: rgba(255,0,85,0.3);
            box-shadow: 0 0 20px rgba(255,0,85,0.2);
        }
        .metrics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .metric-item {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        .metric-label {
            font-size: 12px;
            color: #8b9dc3;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .metric-value {
            font-family: Orbitron, sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-cyan);
        }
        body:not(.light-mode) .metric-value {
            text-shadow: 0 0 10px rgba(0,255,255,0.5);
        }
        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .header { flex-direction: column; gap: 15px; text-align: center; }
            .footer-content { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shield-halved"></i> ANOMALY DETECTION SYSTEM</h1>
            <div class="header-controls">
                <a href="/about" class="nav-link"><i class="fas fa-info-circle"></i> About</a>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                    <span id="themeText">Dark</span>
                </button>
                <div class="status-badge">
                    <i class="fas fa-circle-check"></i>
                    <span>ACTIVE</span>
                </div>
            </div>
        </div>
        
        <div class="alert alert-success" id="successAlert">
            <i class="fas fa-check-circle"></i>
            <span id="successMsg"></span>
        </div>
        
        <div class="alert alert-error" id="errorAlert">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorMsg"></span>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Total Samples</span>
                    <div class="stat-icon" style="color: #00ffff;">
                        <i class="fas fa-database"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalSamples" style="color: #00ffff;">-</div>
                <div class="stat-change">Loaded from dataset</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Threats Detected</span>
                    <div class="stat-icon" style="color: #ff0055;">
                        <i class="fas fa-skull-crossbones"></i>
                    </div>
                </div>
                <div class="stat-value" id="anomaliesDetected" style="color: #ff0055;">-</div>
                <div class="stat-change">Flagged as anomalous</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Secure Samples</span>
                    <div class="stat-icon" style="color: #00ff88;">
                        <i class="fas fa-shield-check"></i>
                    </div>
                </div>
                <div class="stat-value" id="normalSamples" style="color: #00ff88;">-</div>
                <div class="stat-change">Within normal range</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Accuracy</span>
                    <div class="stat-icon" style="color: #ff00ff;">
                        <i class="fas fa-crosshairs"></i>
                    </div>
                </div>
                <div class="stat-value" id="accuracy" style="color: #ff00ff;">-</div>
                <div class="stat-change">Model performance</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-radar"></i>
                    THREAT ANALYSIS
                </h2>
                
                <div class="input-group">
                    <label for="sampleIdx">SAMPLE INDEX (0 - 16489)</label>
                    <input type="number" id="sampleIdx" value="0" min="0" max="16489">
                </div>
                
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="useGenAI" checked style="margin-right: 8px;">
                        Enable GenAI Intelligence Layer
                    </label>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="predictSingle()">
                        <i class="fas fa-play"></i>
                        SCAN SINGLE
                    </button>
                    <button class="btn btn-primary" onclick="explainWithXAI()">
                        <i class="fas fa-brain"></i>
                        XAI + GenAI
                    </button>
                    <button class="btn btn-primary" onclick="genaiAnalyze()">
                        <i class="fas fa-robot"></i>
                        GenAI ONLY
                    </button>
                    <button class="btn btn-secondary" onclick="predictBatch()">
                        <i class="fas fa-layer-group"></i>
                        SCAN BATCH
                    </button>
                    <button class="btn btn-secondary" onclick="loadStatistics()">
                        <i class="fas fa-chart-line"></i>
                        STATISTICS
                    </button>
                    <button class="btn btn-secondary" onclick="generateThreatReport()">
                        <i class="fas fa-shield-alt"></i>
                        THREAT REPORT
                    </button>
                </div>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>SCANNING...</p>
                </div>
                
                <div id="results"></div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-microchip"></i>
                    SYSTEM STATUS
                </h2>
                
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">Threshold</div>
                        <div class="metric-value" id="threshold" style="font-size: 16px;">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Mean Error</div>
                        <div class="metric-value" id="meanError" style="font-size: 16px;">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Std Dev</div>
                        <div class="metric-value" id="stdError" style="font-size: 16px;">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Model</div>
                        <div class="metric-value" style="font-size: 14px;">LSTM-AE</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" style="width: 100%;" onclick="exportReport()">
                        <i class="fas fa-file-export"></i>
                        EXPORT REPORT
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="footer-content">
                <div class="footer-text">
                    &copy; 2025 Anomaly Detection System | Powered by LSTM-AE + XAI
                </div>
                <div class="footer-team">
                    Created by Team <span style="color: var(--accent-magenta);">Disruptors</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            document.getElementById('themeIcon').className = isLight ? 'fas fa-sun' : 'fas fa-moon';
            document.getElementById('themeText').textContent = isLight ? 'Light' : 'Dark';
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        }
        
        // Load saved theme
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeIcon').className = 'fas fa-sun';
                document.getElementById('themeText').textContent = 'Light';
            }
        });
        
        loadDashboard();
        
        function showLoading(show = true) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        function showSuccess(msg) {
            const alert = document.getElementById('successAlert');
            document.getElementById('successMsg').textContent = msg;
            alert.style.display = 'flex';
            setTimeout(() => alert.style.display = 'none', 5000);
        }
        
        function showError(msg) {
            const alert = document.getElementById('errorAlert');
            document.getElementById('errorMsg').textContent = msg;
            alert.style.display = 'flex';
            setTimeout(() => alert.style.display = 'none', 5000);
        }
        
        function loadDashboard() {
            fetch('/api/dashboard')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('totalSamples').textContent = data.total_samples.toLocaleString();
                    document.getElementById('anomaliesDetected').textContent = data.anomalies_detected.toLocaleString();
                    document.getElementById('normalSamples').textContent = data.normal_samples.toLocaleString();
                    document.getElementById('accuracy').textContent = (data.accuracy * 100).toFixed(1) + '%';
                    document.getElementById('threshold').textContent = data.threshold.toFixed(6);
                    document.getElementById('meanError').textContent = data.error_mean.toFixed(6);
                    document.getElementById('stdError').textContent = data.error_std.toFixed(6);
                })
                .catch(err => showError('Error loading dashboard'));
        }
        
        function predictSingle() {
            const idx = parseInt(document.getElementById('sampleIdx').value);
            const useGenAI = document.getElementById('useGenAI').checked;
            showLoading(true);
            
            fetch('/api/predict', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({sample_idx: idx, use_genai: useGenAI})
            })
            .then(r => r.json())
            .then(data => {
                const status = data.prediction === 1 ? 'THREAT' : 'SECURE';
                const statusClass = data.prediction === 1 ? 'anomaly' : 'normal';
                const severityColor = data.severity === 'Critical' ? '#ff0055' : 
                                     data.severity === 'High' ? '#ff6600' :
                                     data.severity === 'Medium' ? '#ffaa00' : '#00ff88';
                
                let factorsHtml = '';
                if (data.contributing_factors) {
                    factorsHtml = '<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,255,255,0.2);">';
                    factorsHtml += '<strong style="color: #00ffff;">üîç XAI Contributing Factors:</strong><ul style="margin: 10px 0 0 20px; color: #8b9dc3;">';
                    data.contributing_factors.forEach(f => {
                        factorsHtml += `<li style="margin: 5px 0;">${f}</li>`;
                    });
                    factorsHtml += '</ul></div>';
                }
                
                // GenAI Analysis Section
                let genaiHtml = '';
                if (data.genai_enabled) {
                    const threatColor = data.is_malicious ? '#ff0055' : '#00ff88';
                    const actionColor = data.requires_immediate_action ? '#ff0055' : '#ffaa00';
                    
                    genaiHtml = `
                        <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.4); border-radius: 10px; border-left: 4px solid #ff00ff;">
                            <h4 style="color: #ff00ff; margin-bottom: 15px;">ü§ñ GenAI Intelligence Analysis</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #8b9dc3;">Classification:</strong>
                                    <span style="color: ${threatColor}; font-weight: bold; text-transform: uppercase;">${data.genai_classification}</span>
                                </div>
                                <div>
                                    <strong style="color: #8b9dc3;">Threat Level:</strong>
                                    <span style="color: ${actionColor}; font-weight: bold;">${data.threat_level}</span>
                                </div>
                                <div>
                                    <strong style="color: #8b9dc3;">GenAI Confidence:</strong>
                                    <span style="color: #00ffff; font-family: Orbitron;">${data.genai_confidence}%</span>
                                </div>
                                <div>
                                    <strong style="color: #8b9dc3;">Action Required:</strong>
                                    <span style="color: ${actionColor}; font-weight: bold;">${data.requires_immediate_action ? 'YES' : 'NO'}</span>
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong style="color: #ff00ff;">üéØ Root Cause:</strong>
                                <p style="color: #e0e7ff; margin: 8px 0; line-height: 1.5;">${data.genai_root_cause}</p>
                            </div>
                            <div>
                                <strong style="color: #ff00ff;">üí° Recommendation:</strong>
                                <p style="color: #e0e7ff; margin: 8px 0; line-height: 1.5;">${data.genai_recommendation}</p>
                            </div>
                        </div>
                    `;
                } else if (data.genai_error) {
                    genaiHtml = `
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255,0,85,0.1); border-radius: 10px; border-left: 4px solid #ff0055;">
                            <h4 style="color: #ff0055; margin-bottom: 10px;">‚ö†Ô∏è GenAI Analysis Failed</h4>
                            <p style="color: #8b9dc3; font-size: 14px;">${data.genai_error}</p>
                        </div>
                    `;
                }
                
                const html = `
                    <div class="result-card ${statusClass}">
                        <div class="result-header">
                            <h3>SAMPLE #${data.sample_idx}</h3>
                            <span class="result-badge ${statusClass}">${status}</span>
                        </div>
                        <div style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 3px solid ${severityColor};">
                            <strong style="color: ${severityColor};">Severity: ${data.severity || 'N/A'}</strong>
                        </div>
                        <div class="result-details">
                            <div class="result-item">
                                <span class="result-label">Error:</span>
                                <span class="result-value">${data.error.toFixed(6)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Threshold:</span>
                                <span class="result-value">${data.threshold.toFixed(6)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">XAI Confidence:</span>
                                <span class="result-value">${(data.confidence * 100).toFixed(1)}%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Actual:</span>
                                <span class="result-value">${data.actual === 1 ? 'Threat' : 'Secure'}</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,255,255,0.2);">
                            <strong style="color: #00ffff;">üí° XAI Analysis:</strong> ${data.reason}
                        </div>
                        ${factorsHtml}
                        ${genaiHtml}
                        <div style="margin-top: 15px; text-align: center; display: flex; gap: 10px; justify-content: center;">
                            <button class="btn btn-secondary" onclick="explainWithXAI(${idx})" style="font-size: 12px;">
                                <i class="fas fa-brain"></i> DETAILED REPORT
                            </button>
                            <button class="btn btn-secondary" onclick="genaiAnalyze(${idx})" style="font-size: 12px;">
                                <i class="fas fa-robot"></i> GenAI ONLY
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('results').innerHTML = html;
                showLoading(false);
            })
            .catch(err => {
                showError('Error making prediction');
                showLoading(false);
            });
        }
        
        function explainWithXAI(idx = null) {
            const sampleIdx = idx !== null ? idx : parseInt(document.getElementById('sampleIdx').value);
            const useGenAI = document.getElementById('useGenAI').checked;
            showLoading(true);
            
            fetch('/api/xai-explain', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({sample_idx: sampleIdx, use_genai: useGenAI})
            })
            .then(r => r.json())
            .then(data => {
                const exp = data.explanation;
                const statusClass = exp.prediction === 'ANOMALY' ? 'anomaly' : 'normal';
                const severityColor = exp.severity === 'Critical' ? '#ff0055' : 
                                     exp.severity === 'High' ? '#ff6600' :
                                     exp.severity === 'Medium' ? '#ffaa00' : '#00ff88';
                
                // GenAI Analysis Section for detailed report
                let genaiDetailHtml = '';
                if (data.genai_analysis && data.genai_analysis.enabled) {
                    const ga = data.genai_analysis;
                    const threatColor = ga.is_malicious ? '#ff0055' : '#00ff88';
                    const actionColor = ga.requires_immediate_action ? '#ff0055' : '#ffaa00';
                    
                    let indicatorsHtml = '';
                    if (ga.threat_indicators && ga.threat_indicators.length > 0) {
                        indicatorsHtml = '<div style="margin-top: 15px;"><strong style="color: #ff00ff;">üö® Threat Indicators:</strong><div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 8px;">';
                        ga.threat_indicators.forEach(indicator => {
                            indicatorsHtml += `<span style="background: rgba(255,0,255,0.2); color: #ff00ff; padding: 4px 8px; border-radius: 12px; font-size: 12px; border: 1px solid rgba(255,0,255,0.3);">${indicator}</span>`;
                        });
                        indicatorsHtml += '</div></div>';
                    }
                    
                    genaiDetailHtml = `
                        <div style="margin-top: 25px; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 12px; border: 2px solid #ff00ff;">
                            <h4 style="color: #ff00ff; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-robot"></i> GenAI Intelligence Analysis
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 5px;">CLASSIFICATION</div>
                                    <div style="color: ${threatColor}; font-weight: bold; text-transform: uppercase; font-size: 16px;">${ga.classification}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 5px;">THREAT LEVEL</div>
                                    <div style="color: ${actionColor}; font-weight: bold; font-size: 16px;">${ga.threat_level}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 5px;">CONFIDENCE</div>
                                    <div style="color: #00ffff; font-weight: bold; font-family: Orbitron; font-size: 16px;">${ga.confidence}%</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 5px;">ACTION REQUIRED</div>
                                    <div style="color: ${actionColor}; font-weight: bold; font-size: 16px;">${ga.requires_immediate_action ? 'IMMEDIATE' : 'MONITOR'}</div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,0,255,0.1); border-radius: 8px; border-left: 4px solid #ff00ff;">
                                <strong style="color: #ff00ff; display: block; margin-bottom: 10px;">üéØ Root Cause Analysis:</strong>
                                <p style="color: #e0e7ff; line-height: 1.6; margin: 0;">${ga.root_cause}</p>
                            </div>
                            <div style="padding: 15px; background: rgba(0,255,255,0.1); border-radius: 8px; border-left: 4px solid #00ffff;">
                                <strong style="color: #00ffff; display: block; margin-bottom: 10px;">üí° Recommended Actions:</strong>
                                <p style="color: #e0e7ff; line-height: 1.6; margin: 0;">${ga.recommendation}</p>
                            </div>
                            ${indicatorsHtml}
                        </div>
                    `;
                } else if (data.genai_analysis && !data.genai_analysis.enabled) {
                    genaiDetailHtml = `
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255,165,0,0.1); border-radius: 10px; border-left: 4px solid #ffaa00;">
                            <h4 style="color: #ffaa00; margin-bottom: 10px;">‚ö†Ô∏è GenAI Analysis Unavailable</h4>
                            <p style="color: #8b9dc3; font-size: 14px;">GenAI analysis was not enabled or failed. Using XAI analysis only.</p>
                        </div>
                    `;
                }
                
                let timestepsHtml = '<div style="margin-top: 15px;"><strong style="color: #00ffff;">‚ö° Top Important Timesteps:</strong><div style="margin-top: 10px;">';
                exp.top_important_timesteps.slice(0, 5).forEach((ts, i) => {
                    const score = exp.top_importance_scores[i];
                    const barWidth = (score * 100 / Math.max(...exp.top_importance_scores)) * 100;
                    timestepsHtml += `
                        <div style="margin: 8px 0;">
                            <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 3px;">
                                <span style="color: #8b9dc3;">Timestep ${ts}</span>
                                <span style="color: #00ffff; font-family: Orbitron;">${score.toFixed(4)}</span>
                            </div>
                            <div style="background: rgba(0,255,255,0.1); height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #00ffff, #ff00ff); height: 100%; width: ${barWidth}%; border-radius: 3px;"></div>
                            </div>
                        </div>
                    `;
                });
                timestepsHtml += '</div></div>';
                
                let patternHtml = '<div style="margin-top: 15px;"><strong style="color: #00ffff;">üî¨ Pattern Analysis:</strong><div style="margin-top: 10px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 13px;">';
                const pa = exp.pattern_analysis;
                patternHtml += `
                    <div>Mean: <span style="color: #00ffff; font-family: Orbitron;">${pa.mean.toFixed(4)}</span></div>
                    <div>Std Dev: <span style="color: #00ffff; font-family: Orbitron;">${pa.std.toFixed(4)}</span></div>
                    <div>Volatility: <span style="color: #00ffff; font-family: Orbitron;">${pa.volatility.toFixed(4)}</span></div>
                    <div>Peaks: <span style="color: #00ffff; font-family: Orbitron;">${pa.peak_count}</span></div>
                    <div>Trend: <span style="color: #00ffff; font-family: Orbitron;">${pa.trend}</span></div>
                    <div>Concentration: <span style="color: #00ffff; font-family: Orbitron;">${(pa.anomaly_concentration * 100).toFixed(1)}%</span></div>
                `;
                patternHtml += '</div></div>';
                
                let factorsHtml = '<div style="margin-top: 15px;"><strong style="color: #00ffff;">üéØ Contributing Factors:</strong><ul style="margin: 10px 0 0 20px; color: #8b9dc3;">';
                exp.contributing_factors.forEach(f => {
                    factorsHtml += `<li style="margin: 5px 0;">${f}</li>`;
                });
                factorsHtml += '</ul></div>';
                
                const html = `
                    <div class="result-card ${statusClass}">
                        <div class="result-header">
                            <h3>üß† ${data.genai_analysis && data.genai_analysis.enabled ? 'XAI + GenAI' : 'XAI'} ANALYSIS REPORT - SAMPLE #${data.sample_idx}</h3>
                            <span class="result-badge ${statusClass}">${exp.prediction}</span>
                        </div>
                        <div style="margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 4px solid ${severityColor};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: ${severityColor}; font-size: 16px;">Severity: ${exp.severity}</strong>
                                <span style="color: #00ffff; font-family: Orbitron;">Confidence: ${(exp.confidence * 100).toFixed(1)}%</span>
                            </div>
                            <div style="color: #e0e7ff; line-height: 1.6;">${exp.reason}</div>
                        </div>
                        <div class="result-details">
                            <div class="result-item">
                                <span class="result-label">Reconstruction Error:</span>
                                <span class="result-value">${exp.reconstruction_error.toFixed(6)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Threshold:</span>
                                <span class="result-value">${exp.threshold.toFixed(6)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Error Ratio:</span>
                                <span class="result-value">${exp.error_ratio.toFixed(2)}x</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">XAI Enabled:</span>
                                <span class="result-value" style="color: #00ff88;">‚úì YES</span>
                            </div>
                        </div>
                        ${timestepsHtml}
                        ${patternHtml}
                        ${factorsHtml}
                        ${genaiDetailHtml}
                    </div>
                `;
                document.getElementById('results').innerHTML = html;
                showSuccess(data.genai_analysis && data.genai_analysis.enabled ? 'XAI + GenAI Analysis Complete' : 'XAI Analysis Complete');
                showLoading(false);
            })
            .catch(err => {
                showError('Error generating XAI explanation');
                showLoading(false);
            });
        }
        
        function predictBatch() {
            const startIdx = parseInt(document.getElementById('sampleIdx').value);
            showLoading(true);
            
            fetch('/api/batch-predict', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({start_idx: startIdx, batch_size: 10})
            })
            .then(r => r.json())
            .then(data => {
                let html = '<h3 style="margin-bottom: 15px; color: #00ffff;">BATCH SCAN RESULTS</h3>';
                data.predictions.forEach(pred => {
                    const statusClass = pred.prediction === 1 ? 'anomaly' : 'normal';
                    const status = pred.prediction === 1 ? 'THREAT' : 'SECURE';
                    html += `
                        <div class="result-card ${statusClass}" style="margin-bottom: 10px;">
                            <div class="result-header">
                                <span><strong>SAMPLE #${pred.idx}</strong></span>
                                <span class="result-badge ${statusClass}">${status}</span>
                            </div>
                            <div style="font-size: 14px; color: #8b9dc3;">
                                Error: <span style="color: #00ffff; font-family: Orbitron;">${pred.error.toFixed(6)}</span>
                            </div>
                        </div>
                    `;
                });
                document.getElementById('results').innerHTML = html;
                showSuccess(`Scanned ${data.processed} samples`);
                showLoading(false);
            })
            .catch(err => {
                showError('Error in batch scan');
                showLoading(false);
            });
        }
        
        function loadStatistics() {
            showLoading(true);
            
            fetch('/api/statistics')
                .then(r => r.json())
                .then(data => {
                    const cm = data.confusion_matrix;
                    const html = `
                        <h3 style="margin-bottom: 15px; color: #00ffff;">PERFORMANCE METRICS</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-label">Accuracy</div>
                                <div class="metric-value">${(data.accuracy * 100).toFixed(2)}%</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Precision</div>
                                <div class="metric-value">${(data.precision * 100).toFixed(2)}%</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Recall</div>
                                <div class="metric-value">${(data.recall * 100).toFixed(2)}%</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">F1-Score</div>
                                <div class="metric-value">${data.f1_score.toFixed(4)}</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 20px; background: rgba(10,14,39,0.5); border-radius: 10px; border: 1px solid rgba(0,255,255,0.2);">
                            <h4 style="margin-bottom: 10px; color: #00ffff;">CONFUSION MATRIX</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 14px;">
                                <div>True Negatives: <strong style="color: #00ff88;">${cm.tn}</strong></div>
                                <div>False Positives: <strong style="color: #ff0055;">${cm.fp}</strong></div>
                                <div>False Negatives: <strong style="color: #ff0055;">${cm.fn}</strong></div>
                                <div>True Positives: <strong style="color: #00ff88;">${cm.tp}</strong></div>
                            </div>
                        </div>
                    `;
                    document.getElementById('results').innerHTML = html;
                    showLoading(false);
                })
                .catch(err => {
                    showError('Error loading statistics');
                    showLoading(false);
                });
        }
        
        function genaiAnalyze(idx = null) {
            const sampleIdx = idx !== null ? idx : parseInt(document.getElementById('sampleIdx').value);
            showLoading(true);
            
            fetch('/api/genai-analyze', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({sample_idx: sampleIdx})
            })
            .then(r => r.json())
            .then(data => {
                const ga = data.genai_analysis;
                const statusClass = ga.classification === 'malicious' ? 'anomaly' : 'normal';
                const severityColor = ga.severity === 'Critical' ? '#ff0055' : 
                                     ga.severity === 'High' ? '#ff6600' :
                                     ga.severity === 'Medium' ? '#ffaa00' : '#00ff88';
                
                let indicatorsHtml = '';
                if (ga.threat_indicators && ga.threat_indicators.length > 0) {
                    indicatorsHtml = '<div style="margin-top: 15px;"><strong style="color: #ff00ff;">üö® Threat Indicators:</strong><div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 8px;">';
                    ga.threat_indicators.forEach(indicator => {
                        indicatorsHtml += `<span style="background: rgba(255,0,255,0.2); color: #ff00ff; padding: 4px 8px; border-radius: 12px; font-size: 12px; border: 1px solid rgba(255,0,255,0.3);">${indicator}</span>`;
                    });
                    indicatorsHtml += '</div></div>';
                }
                
                const html = `
                    <div class="result-card ${statusClass}">
                        <div class="result-header">
                            <h3>ü§ñ GenAI INTELLIGENCE REPORT - SAMPLE #${data.sample_idx}</h3>
                            <span class="result-badge ${statusClass}">${ga.classification.toUpperCase()}</span>
                        </div>
                        <div style="margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.4); border-radius: 10px; border-left: 4px solid ${severityColor};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: ${severityColor}; font-size: 18px;">Severity: ${ga.severity}</strong>
                                <span style="color: #00ffff; font-family: Orbitron; font-size: 16px;">Confidence: ${ga.confidence}%</span>
                            </div>
                        </div>
                        <div class="result-details">
                            <div class="result-item">
                                <span class="result-label">Error:</span>
                                <span class="result-value">${data.error_context.reconstruction_error.toFixed(6)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Threshold:</span>
                                <span class="result-value">${data.error_context.threshold.toFixed(6)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Error Ratio:</span>
                                <span class="result-value">${data.error_context.error_ratio.toFixed(2)}x</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Classification:</span>
                                <span class="result-value" style="color: ${ga.classification === 'malicious' ? '#ff0055' : '#00ff88'}; text-transform: uppercase;">${ga.classification}</span>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255,0,255,0.1); border-radius: 8px; border-left: 4px solid #ff00ff;">
                            <strong style="color: #ff00ff; display: block; margin-bottom: 10px;">üéØ Root Cause Analysis:</strong>
                            <p style="color: #e0e7ff; line-height: 1.6; margin: 0;">${ga.root_cause}</p>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: rgba(0,255,255,0.1); border-radius: 8px; border-left: 4px solid #00ffff;">
                            <strong style="color: #00ffff; display: block; margin-bottom: 10px;">üí° Recommended Actions:</strong>
                            <p style="color: #e0e7ff; line-height: 1.6; margin: 0;">${ga.recommendation}</p>
                        </div>
                        ${indicatorsHtml}
                    </div>
                `;
                document.getElementById('results').innerHTML = html;
                showSuccess('GenAI Analysis Complete');
                showLoading(false);
            })
            .catch(err => {
                showError('Error in GenAI analysis');
                showLoading(false);
            });
        }
        
        function generateThreatReport() {
            const startIdx = parseInt(document.getElementById('sampleIdx').value);
            showLoading(true);
            
            fetch('/api/threat-report', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({start_idx: startIdx, batch_size: 50})
            })
            .then(r => r.json())
            .then(data => {
                const report = data.threat_report;
                const summary = report.threat_summary;
                
                let indicatorsHtml = '';
                if (report.top_threat_indicators && report.top_threat_indicators.length > 0) {
                    indicatorsHtml = '<div style="margin-top: 20px;"><h4 style="color: #ff0055; margin-bottom: 15px;">üö® Top Threat Indicators</h4>';
                    report.top_threat_indicators.forEach(item => {
                        const percentage = (item.count / summary.total_samples_analyzed * 100).toFixed(1);
                        indicatorsHtml += `
                            <div style="margin: 10px 0; padding: 10px; background: rgba(255,0,85,0.1); border-radius: 8px; border-left: 3px solid #ff0055;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #e0e7ff; font-weight: bold;">${item.indicator}</span>
                                    <span style="color: #ff0055; font-family: Orbitron;">${item.count} (${percentage}%)</span>
                                </div>
                            </div>
                        `;
                    });
                    indicatorsHtml += '</div>';
                }
                
                let recommendationsHtml = '';
                if (report.recommendations && report.recommendations.length > 0) {
                    recommendationsHtml = '<div style="margin-top: 20px;"><h4 style="color: #00ffff; margin-bottom: 15px;">üí° Security Recommendations</h4>';
                    report.recommendations.forEach((rec, index) => {
                        const priority = rec.includes('IMMEDIATE') ? '#ff0055' : rec.includes('HIGH') ? '#ff6600' : '#00ffff';
                        recommendationsHtml += `
                            <div style="margin: 8px 0; padding: 12px; background: rgba(0,255,255,0.1); border-radius: 8px; border-left: 3px solid ${priority};">
                                <span style="color: #e0e7ff; line-height: 1.5;">${index + 1}. ${rec}</span>
                            </div>
                        `;
                    });
                    recommendationsHtml += '</div>';
                }
                
                const riskColor = summary.risk_score > 70 ? '#ff0055' : summary.risk_score > 40 ? '#ff6600' : '#00ff88';
                
                const html = `
                    <div class="result-card">
                        <div class="result-header">
                            <h3>üõ°Ô∏è COMPREHENSIVE THREAT REPORT</h3>
                            <span class="result-badge" style="background: linear-gradient(135deg, ${riskColor} 0%, #ff00ff 100%); color: white;">RISK: ${summary.risk_score}%</span>
                        </div>
                        <div style="margin: 20px 0;">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 8px;">SAMPLES ANALYZED</div>
                                    <div style="color: #00ffff; font-size: 24px; font-weight: bold; font-family: Orbitron;">${summary.total_samples_analyzed}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 8px;">MALICIOUS SAMPLES</div>
                                    <div style="color: #ff0055; font-size: 24px; font-weight: bold; font-family: Orbitron;">${summary.malicious_samples}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 8px;">CRITICAL THREATS</div>
                                    <div style="color: #ff0055; font-size: 24px; font-weight: bold; font-family: Orbitron;">${summary.critical_severity}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="color: #8b9dc3; font-size: 12px; margin-bottom: 8px;">HIGH THREATS</div>
                                    <div style="color: #ff6600; font-size: 24px; font-weight: bold; font-family: Orbitron;">${summary.high_severity}</div>
                                </div>
                            </div>
                            <div style="margin: 20px 0; padding: 20px; background: rgba(0,0,0,0.4); border-radius: 12px; border: 2px solid ${riskColor};">
                                <h4 style="color: ${riskColor}; margin-bottom: 15px; text-align: center;">üéØ OVERALL RISK ASSESSMENT</h4>
                                <div style="text-align: center;">
                                    <div style="color: ${riskColor}; font-size: 36px; font-weight: bold; font-family: Orbitron; margin-bottom: 10px;">${summary.risk_score}%</div>
                                    <div style="color: #8b9dc3;">Risk Score (${summary.risk_score > 70 ? 'HIGH RISK' : summary.risk_score > 40 ? 'MEDIUM RISK' : 'LOW RISK'})</div>
                                </div>
                            </div>
                        </div>
                        ${indicatorsHtml}
                        ${recommendationsHtml}
                        <div style="margin-top: 20px; padding: 15px; background: rgba(0,255,255,0.1); border-radius: 8px; text-align: center;">
                            <div style="color: #8b9dc3; font-size: 14px;">Report generated with GenAI Intelligence ‚Ä¢ Analysis Quality: ${report.analysis_quality}</div>
                            <div style="color: #00ffff; font-size: 12px; margin-top: 5px;">GenAI Enabled: ${report.genai_enabled_samples}/${summary.total_samples_analyzed} samples</div>
                        </div>
                    </div>
                `;
                document.getElementById('results').innerHTML = html;
                showSuccess(`Threat Report Generated - Risk Score: ${summary.risk_score}%`);
                showLoading(false);
            })
            .catch(err => {
                showError('Error generating threat report');
                showLoading(false);
            });
        }
        
        function exportReport() {
            showLoading(true);
            fetch('/api/export-report')
                .then(r => r.json())
                .then(data => {
                    showSuccess(data.message + ' (with XAI + GenAI insights)');
                    showLoading(false);
                })
                .catch(err => {
                    showError('Error exporting report');
                    showLoading(false);
                });
        }
    </script>
</body>
</html>
